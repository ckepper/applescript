-- based on https://discussions.apple.com/thread/7743420using terms from application "Mail" on perform mail action with messages theMessages for rule theRule -- Save in a sub-folder based on the name of the rule in Mail  set ruleName to name of theRule  tell application "Finder"   set attachmentsFolder to ((path to home folder as text) & "Downloads") as text  end tell  tell application "Mail"   set windowName to name of window 1   repeat with eachMessage in theMessages    set {year:y, month:m, day:d, hours:h, minutes:min} to eachMessage's date sent    set timeStamp to ("" & y & "-" & my pad(m as integer) & "-" & my pad(d))    set savePath to attachmentsFolder & ":" & timeStamp & " - " & ruleName & " " & originalName    -- print the message    set timeoutSeconds to 2.0    set uiScript to "keystroke \"p\" using command down"    my doWithTimeout(uiScript, timeoutSeconds)    set uiScript to "click menu button \"PDF\" of sheet 1 of windowName of application process \"Mail\""    my doWithTimeout(uiScript, timeoutSeconds)    set uiScript to "click menu item \"Save as PDF\" of menu 1 of menu button \"PDF\" of sheet 1 of window 1 of application process \"Mail\""    my doWithTimeout(uiScript, timeoutSeconds)    set originalName to name of theAttachment    try     save theAttachment in file (savePath)    end try   end repeat  end tell end perform mail action with messagesend using terms from-- Adds leading zeros to date componentson pad(n) return text -2 thru -1 of ("00" & n)end pad-- Do Action with Timeouton doWithTimeout(uiScript, timeoutSeconds) set endDate to (current date) + timeoutSeconds repeat  try   run script "tell application \"System Events\"" & uiScript & "end tell"   exit repeat  on error errorMessage   if ((current date) > endDate) then    error "Can not " & uiScript   end if  end try end repeatend doWithTimeout